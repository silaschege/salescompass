{% extends "ml_dashboard/base_ml.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2.5rem;">
    <div>
        <h1 style="margin: 0; font-size: 2.2rem; font-weight: 700;">Live Monitoring</h1>
        <p style="color: var(--text-muted); margin-top: 0.5rem;">Real-time inference performance and drift detection.
        </p>
    </div>
    <div style="display: flex; gap: 1rem;">
        <button class="btn" style="background: rgba(255,255,255,0.05); color: var(--text-main);"><i
                class="fas fa-calendar"></i> Last 24 Hours</button>
        <button class="btn btn-primary"><i class="fas fa-arrows-rotate"></i> Refresh</button>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
    <div class="card">
        <h3 style="margin: 0 0 2rem;">Inference Throughput</h3>
        <canvas id="throughputChart" height="200"></canvas>
    </div>
    <div class="card">
        <h3 style="margin: 0 0 1.5rem;">Model Stability</h3>
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
            <div>
                <p style="margin: 0 0 0.5rem; font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;">
                    Lead Scoring</p>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="flex-grow: 1; height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                        <div style="width: 98%; height: 100%; background: #22c55e; border-radius: 4px;"></div>
                    </div>
                    <span style="font-size: 0.85rem; font-weight: 600;">98%</span>
                </div>
            </div>
            <div>
                <p style="margin: 0 0 0.5rem; font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;">
                    Win Probability</p>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="flex-grow: 1; height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                        <div style="width: 85%; height: 100%; background: #f59e0b; border-radius: 4px;"></div>
                    </div>
                    <span style="font-size: 0.85rem; font-weight: 600;">85%</span>
                </div>
            </div>
            <div>
                <p style="margin: 0 0 0.5rem; font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase;">
                    Revenue Forecast</p>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="flex-grow: 1; height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px;">
                        <div style="width: 92%; height: 100%; background: #6366f1; border-radius: 4px;"></div>
                    </div>
                    <span style="font-size: 0.85rem; font-weight: 600;">92%</span>
                </div>
            </div>
        </div>
        <div
            style="margin-top: 2rem; padding: 1rem; background: rgba(255,158,11,0.05); border: 1px dashed rgba(255,158,11,0.2); border-radius: 10px;">
            <p style="margin: 0; font-size: 0.8rem; color: #f59e0b;"><i class="fas fa-triangle-exclamation"></i> Low
                drift detected in "Win Probability" industry features.</p>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
    <div class="card">
        <h3 style="margin: 0 0 2rem;">Latency Distribution (ms)</h3>
        <canvas id="latencyChart" height="200"></canvas>
    </div>
    <div class="card">
        <h3 style="margin: 0 0 1.5rem;">Recent Alerts</h3>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div
                style="display: flex; gap: 1rem; align-items: flex-start; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                <div
                    style="width: 32px; height: 32px; border-radius: 50%; background: rgba(239, 68, 68, 0.1); color: #ef4444; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-bolt" style="font-size: 0.8rem;"></i>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.9rem; font-weight: 600;">Drift Alert: Feature 'industry_tech'</p>
                    <p style="margin: 0.2rem 0 0; font-size: 0.75rem; color: var(--text-muted);">Win Probability model
                        observed 15% shift in data distribution.</p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; color: var(--text-muted);">24 minutes ago</p>
                </div>
            </div>
            <div
                style="display: flex; gap: 1rem; align-items: flex-start; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                <div
                    style="width: 32px; height: 32px; border-radius: 50%; background: rgba(34, 197, 94, 0.1); color: #22c55e; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-check" style="font-size: 0.8rem;"></i>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.9rem; font-weight: 600;">Auto-Retrain Successful</p>
                    <p style="margin: 0.2rem 0 0; font-size: 0.75rem; color: var(--text-muted);">Lead Scoring v1.0.4
                        deployed to staging. RMSE: 0.042.</p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; color: var(--text-muted);">2 hours ago</p>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; align-items: flex-start;">
                <div
                    style="width: 32px; height: 32px; border-radius: 50%; background: rgba(59, 130, 246, 0.1); color: #3b82f6; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-info" style="font-size: 0.8rem;"></i>
                </div>
                <div>
                    <p style="margin: 0; font-size: 0.9rem; font-weight: 600;">Action Agent: Outreach Triggered</p>
                    <p style="margin: 0.2rem 0 0; font-size: 0.75rem; color: var(--text-muted);">LeadNurtureAgent
                        contacted 45 high-score leads today.</p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; color: var(--text-muted);">4 hours ago</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Throughput Chart
    const ctxThroughput = document.getElementById('throughputChart').getContext('2d');
    new Chart(ctxThroughput, {
        type: 'line',
        data: {
            labels: ['10:00', '11:00', '12:00', '13:00', '14:00', '15:00'],
            datasets: [{
                label: 'Requests',
                data: [450, 580, 490, 720, 850, 790],
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                fill: true,
                tension: 0.4,
                borderWidth: 3,
                pointRadius: 4,
                pointBackgroundColor: '#6366f1'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
            }
        }
    });

    // Latency Chart
    const ctxLatency = document.getElementById('latencyChart').getContext('2d');
    new Chart(ctxLatency, {
        type: 'bar',
        data: {
            labels: ['Win Prob', 'Lead Score', 'Forecast', 'Recommend'],
            datasets: [{
                data: [4.2, 2.1, 12.5, 3.8],
                backgroundColor: ['#6366f1', '#a855f7', '#f59e0b', '#22c55e'],
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
            }
        }
    });
</script>
{% endblock %}