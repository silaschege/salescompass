{% extends "ml_dashboard/base_ml.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 2.5rem;">
    <div>
        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            <a href="/" style="color: var(--text-muted); text-decoration: none; font-size: 0.9rem;"><i
                    class="fas fa-arrow-left"></i> Registry</a>
            <span style="color: var(--text-muted);">/</span>
            <span style="color: var(--text-main); font-weight: 600;">Model Insights</span>
        </div>
        <h1 style="margin: 0; font-size: 2.2rem; font-weight: 700;">{{ model_id|title }} Model <span
                style="font-weight: 300; color: var(--text-muted);">v1.0.0</span></h1>
    </div>
    <div style="display: flex; gap: 1rem;">
        <button class="btn" style="background: rgba(255,255,255,0.05); color: var(--text-main);"><i
                class="fas fa-download"></i> Export Card</button>
        <button class="btn btn-primary"><i class="fas fa-microchip"></i> Retrain Model</button>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
    <div class="card">
        <h4
            style="margin: 0; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">
            F1-Score</h4>
        <div style="display: flex; align-items: baseline; gap: 0.5rem; margin-top: 0.5rem;">
            <p style="margin: 0; font-size: 2rem; font-weight: 700;">0.892</p>
            <span style="color: #22c55e; font-size: 0.85rem;"><i class="fas fa-caret-up"></i> 1.2%</span>
        </div>
    </div>
    <div class="card">
        <h4
            style="margin: 0; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">
            Recall</h4>
        <div style="display: flex; align-items: baseline; gap: 0.5rem; margin-top: 0.5rem;">
            <p style="margin: 0; font-size: 2rem; font-weight: 700;">0.845</p>
            <span style="color: #ef4444; font-size: 0.85rem;"><i class="fas fa-caret-down"></i> 0.4%</span>
        </div>
    </div>
    <div class="card">
        <h4
            style="margin: 0; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">
            AUC-ROC</h4>
        <div style="display: flex; align-items: baseline; gap: 0.5rem; margin-top: 0.5rem;">
            <p style="margin: 0; font-size: 2rem; font-weight: 700;">0.912</p>
            <span style="color: #22c55e; font-size: 0.85rem;"><i class="fas fa-caret-up"></i> 2.8%</span>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
    <div class="card">
        <h3 style="margin: 0 0 2rem;">Feature Importance (XAI)</h3>
        <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 1.5rem;">Global feature contribution
            based on SHAP values.</p>
        <canvas id="featureChart" height="250"></canvas>
    </div>
    <div class="card">
        <h3 style="margin: 0 0 1.5rem;">Model Specification</h3>
        <div style="display: flex; flex-direction: column; gap: 1.2rem;">
            <div
                style="display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding-bottom: 0.8rem;">
                <span style="color: var(--text-muted); font-size: 0.85rem;">Algorithm</span>
                <span style="font-weight: 600;">XGBoost (Forest)</span>
            </div>
            <div
                style="display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding-bottom: 0.8rem;">
                <span style="color: var(--text-muted); font-size: 0.85rem;">Learning Rate</span>
                <span style="font-weight: 600;">0.0125</span>
            </div>
            <div
                style="display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding-bottom: 0.8rem;">
                <span style="color: var(--text-muted); font-size: 0.85rem;">Features Count</span>
                <span style="font-weight: 600;">42 Managed</span>
            </div>
            <div
                style="display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding-bottom: 0.8rem;">
                <span style="color: var(--text-muted); font-size: 0.85rem;">Target Bias</span>
                <span style="font-weight: 600; color: #f59e0b;">+0.04 (Low)</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-muted); font-size: 0.85rem;">Framework</span>
                <span style="font-weight: 600;">scikit-learn / xgb</span>
            </div>
        </div>
        <div style="margin-top: 2rem; display: flex; flex-direction: column; gap: 0.8rem;">
            <p
                style="margin: 0; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase;">
                Ethical Considerations</p>
            <p style="margin: 0; font-size: 0.8rem; line-height: 1.6;">Model is validated for gender/region bias
                monthly. Current status: <span style="color: #22c55e;">Compliant</span>.</p>
        </div>
    </div>
</div>

<div class="card">
    <h3 style="margin: 0 0 2rem;">Validation Set: Confusion Matrix</h3>
    <div
        style="display: grid; grid-template-columns: repeat(2, 200px); grid-template-rows: repeat(2, 100px); gap: 1rem; justify-content: center; text-align: center;">
        <div
            style="background: rgba(34, 197, 94, 0.15); border: 2px solid #22c55e; border-radius: 12px; display: flex; flex-direction: column; justify-content: center;">
            <span style="font-size: 1.5rem; font-weight: 700;">842</span>
            <span style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase;">True Positive</span>
        </div>
        <div
            style="background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px; display: flex; flex-direction: column; justify-content: center;">
            <span style="font-size: 1.5rem; font-weight: 700; color: var(--text-muted);">42</span>
            <span style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase;">False Positive</span>
        </div>
        <div
            style="background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px; display: flex; flex-direction: column; justify-content: center;">
            <span style="font-size: 1.5rem; font-weight: 700; color: var(--text-muted);">68</span>
            <span style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase;">False Negative</span>
        </div>
        <div
            style="background: rgba(34, 197, 94, 0.15); border: 2px solid #22c55e; border-radius: 12px; display: flex; flex-direction: column; justify-content: center;">
            <span style="font-size: 1.5rem; font-weight: 700;">1,245</span>
            <span style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase;">True Negative</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const ctxFeature = document.getElementById('featureChart').getContext('2d');
    new Chart(ctxFeature, {
        type: 'bar',
        data: {
            labels: ['Industry Seg', 'Last Interaction', 'Deal Velocity', 'Profile Score', 'Lead Source', 'Email CTR', 'Title Match', 'Website Visits'],
            datasets: [{
                label: 'SHAP Value / Importance',
                data: [0.35, 0.28, 0.22, 0.18, 0.14, 0.09, 0.07, 0.05],
                backgroundColor: 'rgba(99, 102, 241, 0.8)',
                borderRadius: 4,
                indexAxis: 'y'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
                x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                y: { grid: { display: false }, ticks: { color: '#94a3b8' } }
            }
        }
    });
</script>
{% endblock %}