{% extends "reports/base.html" %}

{% block title %}Edit {{ object.report_name }} - SalesCompass{% endblock %}

{% block content %}
<div class="header-bar mb-4">
    <div class="container">
        <h1 class="block-title">Edit Report</h1>
        <p class="text-white text-center lead">Update your report configuration</p>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <form method="post" id="report-edit-form">
                        {% csrf_token %}

                        <div class="row">
                            <div class="col-md-6">
                                <!-- Report Name -->
                                <div class="mb-4">
                                    <label for="{{ form.report_name.id_for_label }}"
                                        class="form-label fw-bold text-primary">
                                        Report Name <span class="text-danger">*</span>
                                    </label>
                                    {{ form.report_name }}
                                    {% if form.report_name.errors %}
                                    <div class="text-danger mt-1">{{ form.report_name.errors }}</div>
                                    {% endif %}
                                </div>

                                <!-- Report Type -->
                                <div class="mb-4">
                                    <label for="{{ form.report_type_ref.id_for_label }}"
                                        class="form-label fw-bold text-primary">
                                        Report Type
                                    </label>
                                    {{ form.report_type_ref }}
                                    {% if form.report_type_ref.errors %}
                                    <div class="text-danger mt-1">{{ form.report_type_ref.errors }}</div>
                                    {% endif %}
                                    <div class="form-text text-muted small">
                                        Select the type of report
                                    </div>
                                </div>

                                <!-- Active Status -->
                                <div class="mb-4">
                                    <div class="form-check">
                                        {{ form.report_is_active }}
                                        <label class="form-check-label"
                                            for="{{ form.report_is_active.id_for_label }}">Active</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <!-- Description -->
                                <div class="mb-4">
                                    <label for="{{ form.report_description.id_for_label }}"
                                        class="form-label fw-bold text-primary">
                                        Description
                                    </label>
                                    {{ form.report_description }}
                                    {% if form.report_description.errors %}
                                    <div class="text-danger mt-1">{{ form.report_description.errors }}</div>
                                    {% endif %}
                                    <div class="form-text text-muted small">
                                        Describe what this report is for
                                    </div>
                                </div>

                                <!-- Scheduling -->
                                <div class="mb-4">
                                    <div class="form-check">
                                        {{ form.is_scheduled }}
                                        <label class="form-check-label"
                                            for="{{ form.is_scheduled.id_for_label }}">Scheduled Report</label>
                                    </div>
                                    <div class="form-text text-muted small">
                                        Enable to automatically generate this report on a schedule
                                    </div>
                                </div>

                                <div id="schedule-options" class="mt-3"
                                    style="display: {{ form.is_scheduled.value|yesno:'block,none' }};">
                                    <label for="{{ form.schedule_frequency_ref.id_for_label }}"
                                        class="form-label fw-bold text-primary">
                                        Schedule Frequency
                                    </label>
                                    {{ form.schedule_frequency_ref }}
                                    {% if form.schedule_frequency_ref.errors %}
                                    <div class="text-danger mt-1">{{ form.schedule_frequency_ref.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Query Configuration (Hidden) -->
                        <div class="d-none">
                            {{ form.query_config }}
                        </div>

                        <div
                            class="d-flex flex-wrap gap-2 justify-content-between align-items-center mt-4 pt-3 border-top">
                            <a href="{% url 'reports:report_detail' object.pk %}" class="btn btn-outline-primary">
                                <i class="bi bi-arrow-left"></i> Back to Report
                            </a>
                            <div class="d-flex gap-2">
                                <a href="{% url 'reports:report_detail' object.pk %}" class="btn btn-light">Cancel</a>
                                <button type="submit" class="btn btn-primary">Update Report</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const isScheduledCheckbox = document.getElementById('{{ form.is_scheduled.id_for_label }}');
        const scheduleOptions = document.getElementById('schedule-options');

        if (isScheduledCheckbox) {
            isScheduledCheckbox.addEventListener('change', function () {
                scheduleOptions.style.display = this.checked ? 'block' : 'none';
            });
        }
    });
</script>
{% endblock %}