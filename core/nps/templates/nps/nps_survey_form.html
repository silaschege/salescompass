{% extends "nps/base.html" %}

{% block title %}Create NPS Survey - SalesCompass{% endblock %}

{% block content %}
<div class="header-bar mb-4">
    <div class="container">
        <h1 class="block-title">Create New NPS Survey</h1>
        <p class="text-white text-center lead">Configure your Net Promoter Score survey</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5>Survey Details</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="{{ form.nps_survey_name.id_for_label }}" class="form-label">Survey Name *</label>
                            {{ form.nps_survey_name }}
                            {% if form.nps_survey_name.help_text %}
                                <div class="form-text">{{ form.nps_survey_name.help_text }}</div>
                            {% endif %}
                            {% if form.nps_survey_name.errors %}
                                <div class="text-danger">{{ form.nps_survey_name.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.nps_survey_description.id_for_label }}" class="form-label">Description</label>
                            {{ form.nps_survey_description }}
                            {% if form.nps_survey_description.help_text %}
                                <div class="form-text">{{ form.nps_survey_description.help_text }}</div>
                            {% endif %}
                            {% if form.nps_survey_description.errors %}
                                <div class="text-danger">{{ form.nps_survey_description.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.question_text.id_for_label }}" class="form-label">NPS Question *</label>
                            {{ form.question_text }}
                            {% if form.question_text.help_text %}
                                <div class="form-text">{{ form.question_text.help_text }}</div>
                            {% endif %}
                            {% if form.question_text.errors %}
                                <div class="text-danger">{{ form.question_text.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.follow_up_question.id_for_label }}" class="form-label">Follow-up Question</label>
                            {{ form.follow_up_question }}
                            {% if form.follow_up_question.help_text %}
                                <div class="form-text">{{ form.follow_up_question.help_text }}</div>
                            {% endif %}
                            {% if form.follow_up_question.errors %}
                                <div class="text-danger">{{ form.follow_up_question.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.delivery_method.id_for_label }}" class="form-label">Delivery Method</label>
                                    {{ form.delivery_method }}
                                    {% if form.delivery_method.help_text %}
                                        <div class="form-text">{{ form.delivery_method.help_text }}</div>
                                    {% endif %}
                                    {% if form.delivery_method.errors %}
                                        <div class="text-danger">{{ form.delivery_method.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.trigger_event.id_for_label }}" class="form-label">Trigger Event</label>
                                    {{ form.trigger_event }}
                                    {% if form.trigger_event.help_text %}
                                        <div class="form-text">{{ form.trigger_event.help_text }}</div>
                                    {% endif %}
                                    {% if form.trigger_event.errors %}
                                        <div class="text-danger">{{ form.trigger_event.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            {{ form.nps_survey_is_active }}
                            <label for="{{ form.nps_survey_is_active.id_for_label }}" class="form-check-label">
                                Survey is Active
                            </label>
                            {% if form.nps_survey_is_active.help_text %}
                                <div class="form-text">{{ form.nps_survey_is_active.help_text }}</div>
                            {% endif %}
                            {% if form.nps_survey_is_active.errors %}
                                <div class="text-danger">{{ form.nps_survey_is_active.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.scheduled_start_date.id_for_label }}" class="form-label">Start Date</label>
                                    {{ form.scheduled_start_date }}
                                    {% if form.scheduled_start_date.help_text %}
                                        <div class="form-text">{{ form.scheduled_start_date.help_text }}</div>
                                    {% endif %}
                                    {% if form.scheduled_start_date.errors %}
                                        <div class="text-danger">{{ form.scheduled_start_date.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="{{ form.scheduled_end_date.id_for_label }}" class="form-label">End Date</label>
                                    {{ form.scheduled_end_date }}
                                    {% if form.scheduled_end_date.help_text %}
                                        <div class="form-text">{{ form.scheduled_end_date.help_text }}</div>
                                    {% endif %}
                                    {% if form.scheduled_end_date.errors %}
                                        <div class="text-danger">{{ form.scheduled_end_date.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            {{ form.enable_follow_up_logic }}
                            <label for="{{ form.enable_follow_up_logic.id_for_label }}" class="form-check-label">
                                Enable Conditional Follow-up Logic
                            </label>
                            {% if form.enable_follow_up_logic.help_text %}
                                <div class="form-text">{{ form.enable_follow_up_logic.help_text }}</div>
                            {% endif %}
                            {% if form.enable_follow_up_logic.errors %}
                                <div class="text-danger">{{ form.enable_follow_up_logic.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <h5 class="mt-4">Targeting</h5>
                        <hr>
                        
                        <div class="mb-3">
                            <label for="{{ form.target_roles.id_for_label }}" class="form-label">Target Roles</label>
                            {{ form.target_roles }}
                            {% if form.target_roles.help_text %}
                                <div class="form-text">{{ form.target_roles.help_text }}</div>
                            {% endif %}
                            {% if form.target_roles.errors %}
                                <div class="text-danger">{{ form.target_roles.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.target_territories.id_for_label }}" class="form-label">Target Territories</label>
                            {{ form.target_territories }}
                            {% if form.target_territories.help_text %}
                                <div class="form-text">{{ form.target_territories.help_text }}</div>
                            {% endif %}
                            {% if form.target_territories.errors %}
                                <div class="text-danger">{{ form.target_territories.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Create Survey</button>
                            <a href="{% url 'nps:nps_dashboard' %}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Conditional Follow-up Questions -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>Conditional Follow-up Questions</h5>
                </div>
                <div class="card-body">
                    {{ conditional_follow_up_formset.management_form }}
                    
                    {% for follow_up_form in conditional_follow_up_formset %}
                    <div class="follow-up-form mb-3 p-3 border rounded">
                        {% if follow_up_form.non_field_errors %}
                            <div class="alert alert-danger">
                                {{ follow_up_form.non_field_errors }}
                            </div>
                        {% endif %}
                        
                        {% for hidden in follow_up_form.hidden_fields %}
                            {{ hidden }}
                        {% endfor %}
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="{{ follow_up_form.score_threshold.id_for_label }}" class="form-label">Score Threshold</label>
                                    {{ follow_up_form.score_threshold }}
                                    {% if follow_up_form.score_threshold.errors %}
                                        <div class="text-danger">{{ follow_up_form.score_threshold.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="{{ follow_up_form.conditional_question_text.id_for_label }}" class="form-label">Question Text</label>
                                    {{ follow_up_form.conditional_question_text }}
                                    {% if follow_up_form.conditional_question_text.errors %}
                                        <div class="text-danger">{{ follow_up_form.conditional_question_text.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ follow_up_form.order.id_for_label }}" class="form-label">Order</label>
                            {{ follow_up_form.order }}
                            {% if follow_up_form.order.errors %}
                                <div class="text-danger">{{ follow_up_form.order.errors }}</div>
                            {% endif %}
                        </div>
                        
                        {% if follow_up_form.DELETE %}
                        <div class="form-check">
                            {{ follow_up_form.DELETE }}
                            <label for="{{ follow_up_form.DELETE.id_for_label }}" class="form-check-label">Delete</label>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Save Survey</button>
                        <a href="{% url 'nps:nps_dashboard' %}" class="btn btn-secondary">Cancel</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5>Help</h5>
                </div>
                <div class="card-body">
                    <h6>NPS Survey Best Practices:</h6>
                    <ul>
                        <li>Keep the main question consistent with standard NPS</li>
                        <li>Personalize follow-up questions based on score</li>
                        <li>Schedule surveys at optimal times for response rates</li>
                        <li>Target the right audience for meaningful insights</li>
                    </ul>
                    
                    <h6 class="mt-3">Delivery Methods:</h6>
                    <ul>
                        <li>Email: Traditional email delivery</li>
                        <li>In-App: Show within the application</li>
                        <li>SMS: Text message delivery</li>
                    </ul>
                    
                    <h6 class="mt-3">Trigger Events:</h6>
                    <ul>
                        <li>User Onboarded: After initial setup</li>
                        <li>Case Closed: After support resolution</li>
                        <li>Renewal Completed: After contract renewal</li>
                        <li>Manual: Send manually as needed</li>
                    </ul>
                    
                    <h6 class="mt-3">Conditional Logic:</h6>
                    <ul>
                        <li>Create different follow-ups for promoters, passives, and detractors</li>
                        <li>Ask specific questions based on score ranges</li>
                        <li>Collect more detailed feedback from detractors</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer-bar mt-5">
    <div class="container">
        <p class="text-white mb-0">&copy; 2025 SalesCompass. All rights reserved.</p>
    </div>
</div>
{% endblock %}