{% extends "nps/base.html" %}

{% block title %}Create NPS A/B Test - SalesCompass{% endblock %}

{% block content %}
<div class="header-bar mb-4">
    <div class="container">
        <h1 class="block-title">Create NPS A/B Test</h1>
        <p class="text-white text-center lead">Test different survey variations to optimize response rates</p>
    </div>
</div>

<div class="container">
    <form method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-8">
                <!-- A/B Test Configuration -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>A/B Test Configuration</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="{{ form.survey.id_for_label }}" class="form-label">Survey</label>
                            {{ form.survey }}
                            {% if form.survey.errors %}
                                <div class="text-danger">{{ form.survey.errors }}</div>
                            {% endif %}
                            {% if form.survey.help_text %}
                                <div class="form-text">{{ form.survey.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.nps_abtest_name.id_for_label }}" class="form-label">Test Name</label>
                            {{ form.nps_abtest_name }}
                            {% if form.nps_abtest_name.errors %}
                                <div class="text-danger">{{ form.nps_abtest_name.errors }}</div>
                            {% endif %}
                            {% if form.nps_abtest_name.help_text %}
                                <div class="form-text">{{ form.nps_abtest_name.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3 form-check">
                            {{ form.nps_abtest_is_active }}
                            <label for="{{ form.nps_abtest_is_active.id_for_label }}" class="form-check-label">
                                Is Active
                            </label>
                            {% if form.nps_abtest_is_active.errors %}
                                <div class="text-danger">{{ form.nps_abtest_is_active.errors }}</div>
                            {% endif %}
                            {% if form.nps_abtest_is_active.help_text %}
                                <div class="form-text">{{ form.nps_abtest_is_active.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3 form-check">
                            {{ form.auto_winner }}
                            <label for="{{ form.auto_winner.id_for_label }}" class="form-check-label">
                                Auto Winner
                            </label>
                            {% if form.auto_winner.errors %}
                                <div class="text-danger">{{ form.auto_winner.errors }}</div>
                            {% endif %}
                            {% if form.auto_winner.help_text %}
                                <div class="form-text">{{ form.auto_winner.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.min_responses.id_for_label }}" class="form-label">Minimum Responses</label>
                            {{ form.min_responses }}
                            {% if form.min_responses.errors %}
                                <div class="text-danger">{{ form.min_responses.errors }}</div>
                            {% endif %}
                            {% if form.min_responses.help_text %}
                                <div class="form-text">{{ form.min_responses.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.confidence_level.id_for_label }}" class="form-label">Confidence Level</label>
                            {{ form.confidence_level }}
                            {% if form.confidence_level.errors %}
                                <div class="text-danger">{{ form.confidence_level.errors }}</div>
                            {% endif %}
                            {% if form.confidence_level.help_text %}
                                <div class="form-text">{{ form.confidence_level.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Variants -->
                <div class="card">
                    <div class="card-header">
                        <h5>Survey Variants</h5>
                    </div>
                    <div class="card-body">
                        {{ variants.management_form }}
                        {% for variant_form in variants %}
                        <div class="variant-section mb-3 p-3 border rounded">
                            <h6>Variant {{ forloop.counter }}</h6>
                            
                            {% if variant_form.non_field_errors %}
                                <div class="alert alert-danger">
                                    {{ variant_form.non_field_errors }}
                                </div>
                            {% endif %}
                            
                            {% for hidden in variant_form.hidden_fields %}
                                {{ hidden }}
                            {% endfor %}
                            
                            <div class="mb-3">
                                <label for="{{ variant_form.variant.id_for_label }}" class="form-label">Variant Type</label>
                                {{ variant_form.variant }}
                                {% if variant_form.variant.errors %}
                                    <div class="text-danger">{{ variant_form.variant.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ variant_form.question_text.id_for_label }}" class="form-label">Question Text</label>
                                {{ variant_form.question_text }}
                                {% if variant_form.question_text.errors %}
                                    <div class="text-danger">{{ variant_form.question_text.errors }}</div>
                                {% endif %}
                                {% if variant_form.question_text.help_text %}
                                    <div class="form-text">{{ variant_form.question_text.help_text }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ variant_form.follow_up_question.id_for_label }}" class="form-label">Follow Up Question</label>
                                {{ variant_form.follow_up_question }}
                                {% if variant_form.follow_up_question.errors %}
                                    <div class="text-danger">{{ variant_form.follow_up_question.errors }}</div>
                                {% endif %}
                                {% if variant_form.follow_up_question.help_text %}
                                    <div class="form-text">{{ variant_form.follow_up_question.help_text }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ variant_form.delivery_delay_hours.id_for_label }}" class="form-label">Delivery Delay Hours</label>
                                {{ variant_form.delivery_delay_hours }}
                                {% if variant_form.delivery_delay_hours.errors %}
                                    <div class="text-danger">{{ variant_form.delivery_delay_hours.errors }}</div>
                                {% endif %}
                                {% if variant_form.delivery_delay_hours.help_text %}
                                    <div class="form-text">{{ variant_form.delivery_delay_hours.help_text }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ variant_form.assignment_rate.id_for_label }}" class="form-label">Assignment Rate</label>
                                {{ variant_form.assignment_rate }}
                                {% if variant_form.assignment_rate.errors %}
                                    <div class="text-danger">{{ variant_form.assignment_rate.errors }}</div>
                                {% endif %}
                                {% if variant_form.assignment_rate.help_text %}
                                    <div class="form-text">{{ variant_form.assignment_rate.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Help</h5>
                    </div>
                    <div class="card-body">
                        <h6>A/B Test Best Practices:</h6>
                        <ul>
                            <li>Test one variable at a time</li>
                            <li>Minimum 100 responses per variant</li>
                            <li>Run tests for at least 2 weeks</li>
                            <li>Use 95% confidence level for reliable results</li>
                        </ul>
                        
                        <h6 class="mt-3">Variant Information:</h6>
                        <ul>
                            <li>Variant A is the control group</li>
                            <li>Variant B is the test group</li>
                            <li>Assignment rate determines traffic split</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-primary">Create A/B Test</button>
            <a href="{% url 'nps:nps_dashboard' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<div class="footer-bar mt-5">
    <div class="container">
        <p class="text-white mb-0">&copy; 2025 SalesCompass. All rights reserved.</p>
    </div>
</div>
{% endblock %}