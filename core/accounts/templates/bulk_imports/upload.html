{% extends "accounts/base.html" %}

{% block title %}Import Accounts - Step 1{% endblock %}

{% block content %}
<h1 class="block-title fw-bold mb-0">Bulk Import Accounts</h1>
<p class="text-muted">Step 1 of 3: Upload your CSV file</p>

<div class="card">
    <div class="card-body">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <label for="{{ form.csv_file.id_for_label }}" class="form-label fw-semibold">CSV File</label>
                {{ form.csv_file }}
                {% if form.csv_file.errors %}
                    <div class="text-danger">{{ form.csv_file.errors }}</div>
                {% endif %}
                <div class="form-text">
                    <p><strong>Required columns:</strong> <code>name</code>, <code>industry</code>, <code>country</code></p>
                    <p><strong>Optional columns:</strong> <code>tier</code>, <code>website</code>, <code>address</code>, <code>esg_engagement</code>, <code>sustainability_goals</code>, <code>renewal_date</code>, <code>gdpr_consent</code>, <code>ccpa_consent</code></p>
                    <p>ðŸ’¡ Account owners will be auto-assigned to you.</p>
                    <a href="#" id="download-template" class="btn btn-sm btn-outline-secondary mt-2">Download Template</a>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Upload & Validate</button>
            <a href="{% url 'accounts:account_list' %}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>

<script>
// Optional: Generate CSV template on client
document.getElementById('download-template').addEventListener('click', function(e) {
    e.preventDefault();
    const csvContent = "name,industry,country,tier,website,address,esg_engagement,sustainability_goals,renewal_date,gdpr_consent,ccpa_consent\nAcme Corp,tech,USA,gold,https://acme.com,123 Main St,high,Reduce carbon 50% by 2030,2026-12-31,true,false";
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'accounts_template.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
</script>
{% endblock %}