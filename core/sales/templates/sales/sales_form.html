<!-- sales/templates/sales/sale_form.html -->
{% extends 'sales/base.html' %}

{% block title %}{% if sale %}Edit{% else %}Add{% endif %} Sale | SalesCompass{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card p-4">
        <h2 class="block-title fw-bold mb-4">
            {% if sale %}Edit Sale{% else %}Add New Sale{% endif %}
        </h2>
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                <label class="form-label">Customer</label>
                <select name="customer" class="form-select" required>
                    {% for customer in customers %}
                    <option value="{{ customer.pk }}" {% if sale and sale.customer_id==customer.pk %}selected{% endif
                        %}>
                        {{ customer.name }} ({{ customer.location.location_name }})
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Sale Type</label>
                <select name="sale_type" class="form-select" required>
                    {% for key, label in sale_types %}
                    <option value="{{ key }}" {% if sale and sale.sale_type==key %}selected{% endif %}>
                        {{ label }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Product Name</label>
                <select name="product" class="form-select" required>
                    {% for product in products %}
                    <option value="{{ product.pk }}" {% if sale and sale.product_id==product.pk %}selected{% endif %}>
                        {{ product.name }} ({{ product.price}})
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Amount ($)</label>
                <input type="number" step="0.01" name="amount" class="form-control" value="{{ sale.amount|default:'' }}"
                    required>
            </div>
            <div class="mb-3">
                <label class="form-label">Converted From Outreach (Optional)</label>
                <select name="converted_from_reachout" class="form-select">
                    <option value="">-- Select --</option>
                    {% for log in reachouts %}
                    <option value="{{ log.pk }}" {% if sale and sale.converted_from_reachout_id==log.pk %}selected{%
                        endif %}>
                        {{ log.customer.name }} - {{ log.channel|title }} on {{ log.reachout_date|date:"M d" }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Save Sale</button>
            <a href="{% url 'sales:sale_list' %}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</div>
{% endblock %}