# Generated by Django 5.2.7 on 2025-12-10 14:15

import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('tenants', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='APIToken',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Descriptive name for the token', max_length=255)),
                ('token', models.CharField(help_text='The actual API token', max_length=255, unique=True)),
                ('scopes', models.JSONField(blank=True, default=list, help_text='List of permissions this token has')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='When this token expires', null=True)),
                ('last_used_at', models.DateTimeField(blank=True, help_text='When this token was last used', null=True)),
                ('is_active', models.BooleanField(default=True, help_text='Whether this token is currently active')),
                ('description', models.TextField(blank=True, help_text='Description of what this token is used for')),
                ('ip_restrictions', models.JSONField(blank=True, default=list, help_text='IP addresses from which this token can be used')),
                ('rate_limit', models.IntegerField(default=1000, help_text='Number of requests allowed per time period')),
                ('rate_limit_period_seconds', models.IntegerField(default=3600, help_text='Time period for rate limiting in seconds')),
                ('notes', models.TextField(blank=True, help_text='Internal notes about this token')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tokens_created', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='api_tokens', to='tenants.tenant')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='api_tokens', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'API Token',
                'verbose_name_plural': 'API Tokens',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ConnectorConfiguration',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Name of the connector', max_length=255)),
                ('description', models.TextField(blank=True, help_text='Description of what the connector does')),
                ('connector_type', models.CharField(choices=[('webhook', 'Webhook'), ('api', 'API'), ('database', 'Database'), ('email', 'Email'), ('ftp', 'FTP/SFTP'), ('file', 'File System'), ('queue', 'Message Queue'), ('streaming', 'Streaming'), ('custom', 'Custom')], max_length=100)),
                ('configuration_schema', models.JSONField(blank=True, default=dict, help_text='Schema for connector configuration')),
                ('configuration_values', models.JSONField(blank=True, default=dict, help_text='Actual configuration values')),
                ('is_active', models.BooleanField(default=True, help_text='Whether this connector is active')),
                ('is_encrypted', models.BooleanField(default=True, help_text='Whether sensitive configuration values are encrypted')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_tested', models.DateTimeField(blank=True, help_text='Last time the connector was tested', null=True)),
                ('last_test_result', models.CharField(choices=[('success', 'Success'), ('failure', 'Failure'), ('pending', 'Pending')], default='pending', max_length=20)),
                ('last_test_error', models.TextField(blank=True, help_text='Error message from last test')),
                ('rate_limit_config', models.JSONField(blank=True, default=dict, help_text='Rate limiting configuration')),
                ('retry_policy', models.JSONField(blank=True, default=dict, help_text='Retry policy configuration')),
                ('transformation_rules', models.JSONField(blank=True, default=dict, help_text='Data transformation rules')),
                ('error_handling_config', models.JSONField(blank=True, default=dict, help_text='Error handling configuration')),
                ('monitoring_config', models.JSONField(blank=True, default=dict, help_text='Monitoring configuration')),
                ('tags', models.JSONField(blank=True, default=list, help_text='Tags for organizing connectors')),
                ('notes', models.TextField(blank=True, help_text='Internal notes about this connector')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='connectors_created', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='connector_configurations', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Connector Configuration',
                'verbose_name_plural': 'Connector Configurations',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='IntegrationAuditLog',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('integration_name', models.CharField(help_text='Name of the integration involved', max_length=255)),
                ('action', models.CharField(choices=[('connect', 'Connect'), ('disconnect', 'Disconnect'), ('configure', 'Configure'), ('test', 'Test'), ('sync', 'Sync'), ('data_transfer', 'Data Transfer'), ('error', 'Error'), ('health_check', 'Health Check'), ('rate_limit', 'Rate Limited'), ('retry', 'Retry'), ('transform', 'Transform'), ('validate', 'Validate'), ('cleanup', 'Cleanup'), ('maintenance', 'Maintenance')], max_length=100)),
                ('resource_type', models.CharField(help_text='Type of resource involved in the integration', max_length=100)),
                ('resource_id', models.CharField(blank=True, help_text='ID of the resource involved', max_length=100)),
                ('status', models.CharField(choices=[('success', 'Success'), ('partial_success', 'Partial Success'), ('failure', 'Failure'), ('timeout', 'Timeout'), ('cancelled', 'Cancelled')], default='success', max_length=20)),
                ('request_payload', models.TextField(blank=True, help_text='Request payload sent to the integration')),
                ('response_payload', models.TextField(blank=True, help_text='Response received from the integration')),
                ('response_status_code', models.IntegerField(blank=True, help_text='HTTP status code from the response', null=True)),
                ('execution_time_ms', models.FloatField(blank=True, help_text='Time taken to execute the action in milliseconds', null=True)),
                ('error_message', models.TextField(blank=True, help_text='Error message if the action failed')),
                ('ip_address', models.GenericIPAddressField(blank=True, help_text='IP address of the requesting client', null=True)),
                ('user_agent', models.TextField(blank=True, help_text='User agent string of the requesting client')),
                ('timestamp', models.DateTimeField(default=django.utils.timezone.now)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional metadata about the action')),
                ('tags', models.JSONField(blank=True, default=list, help_text='Tags for organizing audit logs')),
                ('tenant', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='integration_audit_logs', to='tenants.tenant')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='integration_audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Integration Audit Log',
                'verbose_name_plural': 'Integration Audit Logs',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='IntegrationHealthCheck',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Name of the integration', max_length=255)),
                ('description', models.TextField(blank=True, help_text='Description of the integration')),
                ('endpoint_url', models.URLField(help_text='URL of the integration endpoint', max_length=500)),
                ('auth_method', models.CharField(choices=[('api_key', 'API Key'), ('oauth', 'OAuth'), ('basic_auth', 'Basic Authentication'), ('bearer_token', 'Bearer Token'), ('custom', 'Custom')], max_length=50)),
                ('auth_config', models.JSONField(blank=True, default=dict, help_text='Authentication configuration')),
                ('health_check_frequency_minutes', models.IntegerField(default=5, help_text='How often to check health in minutes')),
                ('last_checked', models.DateTimeField(blank=True, help_text='Last time health was checked', null=True)),
                ('last_status', models.CharField(choices=[('healthy', 'Healthy'), ('warning', 'Warning'), ('error', 'Error'), ('critical', 'Critical')], default='healthy', max_length=20)),
                ('last_response_time_ms', models.FloatField(blank=True, help_text='Last response time in milliseconds', null=True)),
                ('last_error', models.TextField(blank=True, help_text='Last error message if any')),
                ('is_active', models.BooleanField(default=True, help_text='Whether health checks are active for this integration')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('failure_threshold', models.IntegerField(default=3, help_text='Number of consecutive failures before marking as unhealthy')),
                ('consecutive_failure_count', models.IntegerField(default=0, help_text='Current count of consecutive failures')),
                ('last_successful_check', models.DateTimeField(blank=True, help_text='Last time the integration was healthy', null=True)),
                ('tags', models.JSONField(blank=True, default=list, help_text='Tags for organizing integrations')),
                ('notes', models.TextField(blank=True, help_text='Internal notes about this integration')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='integration_health_checks_created', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='integration_health_checks', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Integration Health Check',
                'verbose_name_plural': 'Integration Health Checks',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='MarketplaceApp',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Name of the marketplace app', max_length=255)),
                ('description', models.TextField(blank=True, help_text='Description of what the app does')),
                ('version', models.CharField(default='1.0.0', help_text='Version of the app', max_length=50)),
                ('publisher', models.CharField(help_text='Publisher of the app', max_length=255)),
                ('publisher_website', models.URLField(blank=True, help_text="Publisher's website")),
                ('icon_url', models.URLField(blank=True, help_text="URL to the app's icon")),
                ('screenshots', models.JSONField(blank=True, default=list, help_text='List of screenshot URLs')),
                ('categories', models.JSONField(blank=True, default=list, help_text='Categories this app belongs to')),
                ('tags', models.JSONField(blank=True, default=list, help_text='Tags for the app')),
                ('pricing_model', models.CharField(choices=[('free', 'Free'), ('freemium', 'Freemium'), ('paid', 'Paid'), ('subscription', 'Subscription'), ('one_time', 'One-time Purchase'), ('usage_based', 'Usage-based')], default='free', max_length=50)),
                ('price', models.DecimalField(decimal_places=2, default=0.0, help_text='Price of the app', max_digits=10)),
                ('currency', models.CharField(default='USD', help_text='Currency for the price', max_length=3)),
                ('rating', models.FloatField(default=0.0, help_text='Average rating of the app')),
                ('rating_count', models.IntegerField(default=0, help_text='Number of ratings received')),
                ('download_count', models.IntegerField(default=0, help_text='Number of times the app has been downloaded')),
                ('installation_count', models.IntegerField(default=0, help_text='Number of active installations')),
                ('is_featured', models.BooleanField(default=False, help_text='Whether this app is featured')),
                ('is_verified', models.BooleanField(default=False, help_text='Whether this app is verified by us')),
                ('is_active', models.BooleanField(default=True, help_text='Whether this app is available in the marketplace')),
                ('approval_status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('suspended', 'Suspended')], default='pending', max_length=20)),
                ('approval_notes', models.TextField(blank=True, help_text='Notes from the approval process')),
                ('approved_at', models.DateTimeField(blank=True, help_text='When the app was approved', null=True)),
                ('published_at', models.DateTimeField(blank=True, help_text='When the app was published', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('installation_config', models.JSONField(blank=True, default=dict, help_text='Configuration required for installation')),
                ('compatibility', models.JSONField(blank=True, default=dict, help_text='Compatibility information')),
                ('changelog', models.JSONField(blank=True, default=list, help_text='List of changes in each version')),
                ('support_url', models.URLField(blank=True, help_text='URL for support')),
                ('documentation_url', models.URLField(blank=True, help_text='URL for documentation')),
                ('privacy_policy_url', models.URLField(blank=True, help_text='URL for privacy policy')),
                ('terms_of_service_url', models.URLField(blank=True, help_text='URL for terms of service')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='apps_approved', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='apps_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Marketplace App',
                'verbose_name_plural': 'Marketplace Apps',
                'ordering': ['-created_at'],
            },
        ),
    ]
