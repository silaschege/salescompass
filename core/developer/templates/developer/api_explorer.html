NEW_FILE_CODE
{% extends "developer/base.html" %}
{% load static %}
{% block title %}API Explorer - Developer Portal{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>API Explorer</h1>
        <div class="d-flex gap-2">
            <a href="{% url 'developer:documentation' %}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-book me-1"></i> Documentation
            </a>
            <a href="{% url 'swagger-ui' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-play-circle me-1"></i> Try It
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <!-- API Overview -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">Getting Started</h5>
                    <p class="card-text">Our API provides a powerful interface for integrating with SalesCompass CRM.
                        Below are examples of common API requests and responses to help you get started.</p>
                    
                    <div class="alert alert-info d-flex align-items-center" role="alert">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <div>
                            All API requests require an <code>Authorization</code> header with your API key.
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Examples -->
            <div class="mb-4">
                <h4 class="mb-3">API Examples</h4>
                
                <!-- Example 1: Create Contact -->
                <div class="card mb-3">
                    <div class="card-header bg-white">
                        <code>POST /api/contacts/</code>
                        <span class="badge bg-primary ms-2">Create Contact</span>
                    </div>
                    <div class="card-body">
                        <h6 class="text-muted mb-3">Request</h6>
                        <pre class="bg-light p-3 rounded mb-3">
{
  "first_name": "John",
  "last_name": "Doe",
  "email": "john.doe@example.com",
  "phone": "+15551234567"
}
                        </pre>
                        
                        <h6 class="text-muted mb-3">Response</h6>
                        <pre class="bg-success-subtle p-3 rounded mb-0 text-success-emphasis">
{
  "id": "cnt_12345",
  "first_name": "John",
  "last_name": "Doe",
  "email": "john.doe@example.com",
  "created_at": "2025-12-26T16:42:39Z"
}
                        </pre>
                    </div>
                </div>
                
                <!-- Example 2: List Opportunities -->
                <div class="card mb-3">
                    <div class="card-header bg-white">
                        <code>GET /api/opportunities/</code>
                        <span class="badge bg-primary ms-2">List Opportunities</span>
                    </div>
                    <div class="card-body">
                        <h6 class="text-muted mb-3">Request</h6>
                        <pre class="bg-light p-3 rounded mb-3">
GET /api/opportunities/?page=1&limit=10
Authorization: Bearer your_api_key_here
                        </pre>
                        
                        <h6 class="text-muted mb-3">Response</h6>
                        <pre class="bg-success-subtle p-3 rounded mb-0 text-success-emphasis">
{
  "count": 150,
  "next": "https://api.salescompass.com/api/opportunities/?page=2&limit=10",
  "previous": null,
  "results": [
    {
      "id": "opp_12345",
      "name": "Enterprise Software Deal",
      "amount": 150000,
      "stage": "qualified",
      "probability": 0.75
    },
    {
      "id": "opp_12346",
      "name": "Cloud Infrastructure Deal",
      "amount": 85000,
      "stage": "prospecting",
      "probability": 0.45
    }
  ]
}
                        </pre>
                    </div>
                </div>
                
                <!-- Example 3: Create Webhook -->
                <div class="card mb-3">
                    <div class="card-header bg-white">
                        <code>POST /api/webhooks/</code>
                        <span class="badge bg-primary ms-2">Create Webhook</span>
                    </div>
                    <div class="card-body">
                        <h6 class="text-muted mb-3">Request</h6>
                        <pre class="bg-light p-3 rounded mb-3">
{
  "name": "New Contact Webhook",
  "url": "https://your-webhook-endpoint.com",
  "events": ["contact.created", "contact.updated"],
  "secret": "your_signing_secret"
}
                        </pre>
                        
                        <h6 class="text-muted mb-3">Response</h6>
                        <pre class="bg-success-subtle p-3 rounded mb-0 text-success-emphasis">
{
  "id": "webhook_12345",
  "name": "New Contact Webhook",
  "url": "https://your-webhook-endpoint.com",
  "events": ["contact.created", "contact.updated"],
  "active": true,
  "created_at": "2025-12-26T16:42:39Z"
}
                        </pre>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- API Documentation -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">API Documentation</h5>
                    <div class="d-grid gap-2">
                        <a href="{% url 'swagger-ui' %}" class="btn btn-primary btn-lg">
                            <i class="bi bi-play-circle me-2"></i> Interactive Explorer
                        </a>
                        <a href="{% url 'redoc' %}" class="btn btn-outline-primary">
                            <i class="bi bi-file-earmark-text me-2"></i> ReDoc Documentation
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Authentication -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">Authentication</h5>
                    <p class="small text-muted">All API requests require an API key in the Authorization header</p>
                    <pre class="bg-light p-3 rounded">
Authorization: Bearer your_api_key_here
                    </pre>
                    
                    <div class="mt-3">
                        <a href="{% url 'developer:api_keys' %}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-key me-1"></i> Manage API Keys
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Rate Limits -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">Rate Limits</h5>
                    <div class="d-flex align-items-center mb-2">
                        <div class="flex-grow-1">Requests per minute</div>
                        <div class="fw-bold">120</div>
                    </div>
                    <div class="progress mb-3" style="height: 10px;">
                        <div class="progress-bar" role="progressbar" style="width: 40%;" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">40%</div>
                    </div>
                    
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">Requests per hour</div>
                        <div class="fw-bold">1000</div>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                    </div>
                </div>
            </div>
            
            <!-- Webhook Testing -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-3">Webhook Testing</h5>
                    <p class="small text-muted">Use our test endpoint to verify your webhook integration</p>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control form-control-sm" value="https://your-webhook-endpoint.com" readonly>
                        <button class="btn btn-sm btn-outline-primary" type="button">
                            <i class="bi bi-arrow-repeat me-1"></i> Test
                        </button>
                    </div>
                    
                    <div class="form-text small mb-3">
                        We'll send a test event to verify your endpoint
                    </div>
                    
                    <div class="d-grid">
                        <button class="btn btn-sm btn-outline-secondary" type="button">
                            <i class="bi bi-bug me-1"></i> Debug Webhooks
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add any interactive elements for the API examples
    document.addEventListener('DOMContentLoaded', function () {
        // Add copy buttons to code blocks
        const codeBlocks = document.querySelectorAll('pre');
        codeBlocks.forEach(block => {
            const copyBtn = document.createElement('button');
            copyBtn.className = 'btn btn-sm btn-secondary copy-btn';
            copyBtn.innerHTML = '<i class="bi bi-clipboard me-1"></i> Copy';
            copyBtn.style.position = 'absolute';
            copyBtn.style.top = '10px';
            copyBtn.style.right = '10px';
            copyBtn.style.zIndex = '1';
            
            // Wrap code block in a relative div to position the button
            const wrapper = document.createElement('div');
            wrapper.style.position = 'relative';
            block.parentNode.insertBefore(wrapper, block);
            wrapper.appendChild(block);
            wrapper.appendChild(copyBtn);
            
            // Copy functionality
            copyBtn.addEventListener('click', () => {
                const text = block.textContent;
                navigator.clipboard.writeText(text).then(() => {
                    copyBtn.innerHTML = '<i class="bi bi-check2-circle me-1"></i> Copied!';
                    copyBtn.className = 'btn btn-sm btn-success copy-btn';
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="bi bi-clipboard me-1"></i> Copy';
                        copyBtn.className = 'btn btn-sm btn-secondary copy-btn';
                    }, 2000);
                });
            });
        });
    });
</script>
{% endblock %}