# üîó **Accounts and Leads Module Interaction**

The Accounts and Leads modules in SalesCompass have a **crucial, bidirectional relationship** that forms the foundation of your CRM data flow. Here's a comprehensive breakdown of how they interact:

---

## üîÑ **Core Relationship Flow**

### **1. Lead-to-Account Conversion**
```
Lead (Prospect) ‚Üí Qualified Lead ‚Üí Converted to Account
```

- **Leads exist independently** as potential customers
- **When a lead converts**, it becomes an **Account** (and potentially an Opportunity)
- **The original lead record is linked** to the new Account for historical tracking

### **2. Account-to-Lead Association**
```
Account (Existing Customer) ‚Üí New Lead (Upsell/Cross-sell)
```

- **Existing accounts can generate new leads** for additional business
- **These leads are pre-associated** with the existing account
- **Different lead sources** track the origin (e.g., "Renewal", "Upsell Campaign")

---

## üìä **Database Schema Relationships**

### **Account Model**
```python
class Account(TenantModel):
    name = models.CharField(max_length=255)
    # ... other fields ...
    
    # Reverse relationship to leads
    # leads = models.ForeignKey('leads.Lead', on_delete=models.SET_NULL, null=True, blank=True)
```

### **Lead Model**
```python
class Lead(TenantModel):
    first_name = models.CharField(max_length=100)
    last_name = models.CharField(max_length=100)
    company = models.CharField(max_length=255)
    email = models.EmailField()
    status = models.CharField(max_length=20, choices=LEAD_STATUS_CHOICES)
    
    # Optional relationship to existing account
    account = models.ForeignKey(
        'accounts.Account', 
        on_delete=models.SET_NULL, 
        null=True, 
        blank=True,
        related_name='leads'  # Account.leads.all()
    )
    
    # Track conversion
    converted_to_account = models.OneToOneField(
        'accounts.Account',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='converted_from_lead'
    )
    
    # Lead source tracking
    lead_source = models.CharField(max_length=50, choices=LEAD_SOURCE_CHOICES)
```

---

## üéØ **Key Interaction Scenarios**

### **Scenario 1: New Prospect Becomes Customer**
1. **Lead Creation**: Web form creates a new lead with `status='new'`
2. **Lead Qualification**: Sales rep updates lead to `status='qualified'`
3. **Account Creation**: Lead is converted to account via "Convert to Account" action
4. **Data Migration**: Lead contact info becomes the primary contact for the new account
5. **Historical Link**: `converted_from_lead` field maintains the relationship

### **Scenario 2: Existing Customer Generates New Lead**
1. **Account Exists**: Company "Acme Corp" is already a customer
2. **New Lead Created**: Marketing campaign generates lead for "Acme Corp - ESG Upgrade"
3. **Pre-population**: Lead form auto-fills company name and links to existing account
4. **Opportunity Creation**: Lead converts to opportunity under existing account
5. **Cross-sell Tracking**: Lead source indicates "Existing Customer - Upsell"

### **Scenario 3: Duplicate Prevention**
1. **Lead Entry**: New lead created for "Acme Corp"
2. **Duplicate Check**: System checks for existing accounts with same company name/email
3. **Suggestion**: "Account 'Acme Corp' already exists. Link to existing account?"
4. **Decision**: User chooses to either link to existing account or create new account

---

## üîß **Technical Implementation Details**

### **1. Conversion Workflow (Views)**
```python
# apps/leads/views.py
class ConvertLeadToAccountView(View):
    def post(self, request, pk):
        lead = get_object_or_404(Lead, pk=pk)
        
        # Create new account from lead data
        account = Account.objects.create(
            name=lead.company,
            industry=lead.industry,
            tenant_id=lead.tenant_id,
            # ... other fields from lead
        )
        
        # Create primary contact
        Contact.objects.create(
            account=account,
            first_name=lead.first_name,
            last_name=lead.last_name,
            email=lead.email,
            is_primary=True,
            tenant_id=lead.tenant_id
        )
        
        # Link lead to account
        lead.converted_to_account = account
        lead.status = 'converted'
        lead.save()
        
        # Create opportunity if needed
        if lead.create_opportunity:
            Opportunity.objects.create(
                account=account,
                name=f"Initial Opportunity - {account.name}",
                tenant_id=lead.tenant_id
            )
        
        return redirect('accounts:detail', pk=account.pk)
```

### **2. Account Lead Association (Forms)**
```python
# apps/leads/forms.py
class LeadForm(forms.ModelForm):
    class Meta:
        model = Lead
        fields = ['first_name', 'last_name', 'company', 'email', 'phone', 'account']
    
    def __init__(self, *args, **kwargs):
        user = kwargs.pop('user', None)
        super().__init__(*args, **kwargs)
        
        if user:
            # Pre-populate account field if company exists
            self.fields['account'].queryset = Account.objects.filter(
                tenant_id=user.tenant_id
            )
            
            # Auto-link if company matches existing account
            if self.data.get('company'):
                existing_account = Account.objects.filter(
                    name=self.data['company'],
                    tenant_id=user.tenant_id
                ).first()
                if existing_account:
                    self.fields['account'].initial = existing_account
```

### **3. Duplicate Detection (Utils)**
```python
# apps/leads/utils.py
def find_duplicate_accounts(lead_data, tenant_id):
    """Find existing accounts that match lead data."""
    duplicates = Account.objects.filter(tenant_id=tenant_id)
    
    # Match by company name
    if lead_data.get('company'):
        duplicates = duplicates.filter(name__icontains=lead_data['company'])
    
    # Match by email (through contacts)
    if lead_data.get('email'):
        duplicates = duplicates.filter(
            contacts__email__iexact=lead_data['email']
        )
    
    return duplicates.distinct()
```

---

## üìà **Business Intelligence & Reporting**

### **1. Lead Conversion Metrics**
- **Conversion Rate**: Leads ‚Üí Accounts over time
- **Time to Convert**: Average days from lead creation to account conversion
- **Source Effectiveness**: Which lead sources create the most accounts

### **2. Account Growth Tracking**
- **Account Expansion**: Existing accounts generating new leads/opportunities
- **Customer Lifetime Value**: Track all business from lead-to-account journey
- **Churn Analysis**: Accounts that don't generate new leads may be at risk

### **3. Cross-Module Dashboards**
```python
# Marketing sees: Lead sources ‚Üí Account creation
# Sales sees: Account health ‚Üí New lead generation  
# Executives see: Overall pipeline from lead to revenue
```

---

## üîê **Permission & Security Considerations**

### **1. Data Access Rules**
- **Lead owners** can see linked accounts
- **Account owners** can see all leads associated with their accounts
- **Tenant isolation** ensures data separation between customers

### **2. Audit Trail**
```python
# Track all conversions
LeadConversionLog.objects.create(
    lead=lead,
    account=account,
    converted_by=request.user,
    tenant_id=lead.tenant_id
)
```

### **3. Validation Rules**
- **Cannot convert** leads without proper qualification
- **Cannot link** leads to accounts without permission
- **Duplicate prevention** at point of entry

---

## üöÄ **Advanced Features Enabled by This Relationship**

### **1. Automated Workflows**
```python
# When lead converts to account ‚Üí Send welcome email
# When existing account creates lead ‚Üí Notify account manager
# When lead duplicates account ‚Üí Flag for review
```

### **2. Predictive Scoring**
- **Lead Score**: Based on company (account) characteristics
- **Account Health**: Influenced by lead activity from that company
- **Churn Risk**: Accounts with declining lead activity flagged

### **3. ESG Integration**
- **Lead ESG Interest** ‚Üí Account ESG engagement tracking
- **Account ESG Score** ‚Üí Influences lead qualification rules
- **Sustainability reporting** across lead-to-account lifecycle

---

## üì± **User Experience Flow**

### **Sales Rep Workflow**
1. **View Lead**: See if lead is linked to existing account
2. **Convert Lead**: One-click conversion creates account + contact
3. **Manage Account**: All lead history visible in account timeline
4. **Generate New Lead**: From account page for upsell opportunities

### **Marketing Workflow**
1. **Create Campaign**: Target leads or existing accounts
2. **Track Results**: See which leads become accounts
3. **Analyze Performance**: ROI from lead source to account revenue
4. **Segment Audiences**: Leads vs. existing account contacts

### **Customer Success Workflow**
1. **Monitor Accounts**: Watch for new leads from existing accounts
2. **Identify Expansion**: New leads indicate growth opportunities
3. **Prevent Churn**: No new leads may signal dissatisfaction
4. **Cross-sell**: Proactively create leads for additional services

---

## ‚úÖ **Best Practices for Implementation**

### **1. Data Integrity**
- **Always maintain** the lead-to-account relationship
- **Never delete** converted leads (archive instead)
- **Validate duplicates** before account creation

### **2. Performance Optimization**
- **Index relationships** for fast lookups
- **Cache account information** on lead records
- **Batch operations** for bulk lead processing

### **3. User Experience**
- **Clear visual indicators** for linked vs. new accounts
- **One-click actions** for common workflows
- **Contextual help** explaining the relationship

This tight integration between Accounts and Leads creates a **comprehensive customer lifecycle view** that enables better sales, marketing, and customer success outcomes while maintaining data integrity and security.




























# üöÄ **What Happens After Lead Creation: Next Steps**

After creating a lead in SalesCompass, the sales rep should follow a structured workflow to maximize conversion opportunities. Here's the complete post-lead-creation journey:

---

## üìã **Immediate Next Steps (Within 24 Hours)**

### **1. Lead Qualification**
**Module**: Leads Module
**Action**: Assess lead quality and assign priority

```python
# Lead qualification workflow
if lead.lead_score >= 80:
    lead.status = 'qualified'
    lead.priority = 'high'
elif lead.lead_score >= 50:
    lead.status = 'in_progress' 
    lead.priority = 'medium'
else: 
    lead.status = 'new'
    lead.priority = 'low'
```

**Template**: `leads/lead_detail.html` with qualification buttons

### **2. Lead Assignment**
**Module**: Leads Module ‚Üí **Accounts Module** (if converting)
**Action**: Assign to appropriate sales rep based on:
- Territory/region
- Product expertise  
- Current workload
- Account relationship

### **3. Initial Contact**
**Module**: Leads Module
**Action**: First outreach via preferred communication method
- **Email template** with personalized message
- **Phone call** for high-priority leads
- **LinkedIn connection** for social selling

---

## üîÅ **Lead-to-Account Conversion Workflow**

### **Scenario A: New Prospect (No Existing Account)**

#### **Step 1: Lead Qualification**
- **Status**: `new` ‚Üí `qualified`
- **Action**: Sales rep reviews lead details and scores

#### **Step 2: Account Creation** 
- **Module**: Leads ‚Üí Accounts
- **Action**: Convert qualified lead to new account
- **Template**: `leads/convert_lead_to_account.html`

```html
<!-- Convert Lead Button -->
<a href="{% url 'leads:convert_to_account' lead.pk %}" class="btn btn-success">
    <i class="bi bi-arrow-right-circle"></i> Convert to Account
</a>
```

#### **Step 3: Account Setup**
- **Primary contact** created from lead information
- **Account tier** assigned based on lead scoring
- **Health score** initialized
- **ESG engagement** tracking started

#### **Step 4: Opportunity Creation**
- **Initial opportunity** created automatically
- **Pipeline stage**: `prospecting`
- **Weighted value** calculated

### **Scenario B: Existing Customer (Upsell/Cross-sell)**

#### **Step 1: Lead Association**
- **Lead linked** to existing account (`lead.account = existing_account`)
- **No account creation** needed

#### **Step 2: Opportunity Creation**
- **New opportunity** under existing account
- **Opportunity type**: `upsell`, `cross_sell`, or `renewal`
- **Advanced pipeline stages** available

#### **Step 3: Account Manager Notification**
- **Automated alert** to account manager
- **Timeline event** added to account history

---

## üéØ **Sales Rep Workflow Dashboard**

### **Module Navigation Flow**

| **Current Module** | **Next Module** | **Key Action** | **Business Impact** |
|-------------------|----------------|----------------|-------------------|
| **Leads Module** | Leads Module | Qualify lead | Move lead through funnel |
| **Leads Module** | Accounts Module | Convert to account | Create new revenue stream |
| **Leads Module** | Opportunities Module | Create opportunity | Start sales pipeline |
| **Accounts Module** | Leads Module | Create upsell lead | Expand existing revenue |

### **User Interface Elements**

#### **Lead Detail Page Actions**
```html
<!-- Lead Detail Template -->
<div class="card">
    <div class="card-body">
        <div class="d-grid gap-2">
            <!-- Qualification Actions -->
            {% if lead.status == 'new' %}
                <button class="btn btn-primary" onclick="qualifyLead({{ lead.id }})">Qualify Lead</button>
            {% endif %}
            
            <!-- Conversion Actions -->
            {% if lead.status == 'qualified' and not lead.converted_to_account %}
                <a href="{% url 'leads:convert_to_account' lead.id %}" class="btn btn-success">
                    Convert to Account
                </a>
            {% endif %}
            
            <!-- Opportunity Actions -->
            {% if lead.account %}
                <a href="{% url 'opportunities:create_from_lead' lead.id %}" class="btn btn-info">
                    Create Opportunity
                </a>
            {% endif %}
            
            <!-- Account Actions -->
            {% if lead.converted_to_account %}
                <a href="{% url 'accounts:detail' lead.converted_to_account.id %}" class="btn btn-outline-primary">
                    View Account
                </a>
            {% endif %}
        </div>
    </div>
</div>
```

---

## ü§ñ **Automated Next Steps (System-Driven)**

### **1. Email Drip Campaigns**
**Module**: Marketing Module
**Trigger**: Lead creation
**Actions**:
- Day 1: Welcome email with relevant content
- Day 3: Product/service information
- Day 7: Case study or testimonial
- Day 14: Follow-up with call-to-action

### **2. Task Creation**
**Module**: Tasks Module  
**Trigger**: Lead qualification
**Actions**:
- **High priority**: Call within 2 hours
- **Medium priority**: Email within 24 hours  
- **Low priority**: Add to nurture campaign

### **3. Notification System**
**Module**: Engagement Hub
**Recipients**:
- **Sales manager**: New qualified leads
- **Account manager**: Upsell opportunities
- **Marketing team**: Lead source performance

---

## üìä **Performance Tracking & Analytics**

### **Key Metrics to Monitor**

| **Metric** | **Target** | **Tracking Module** |
|------------|------------|-------------------|
| Lead Response Time | < 5 minutes | Engagement Hub |
| Lead-to-Account Conversion Rate | > 25% | Reports Module |
| Average Deal Size (New vs Existing) | Track separately | Opportunities Module |
| Sales Cycle Length | < 30 days | Pipeline Analytics |

### **Dashboard Views**

#### **Sales Rep Dashboard**
- **My Leads**: Recently created and assigned leads
- **Qualified Leads**: Ready for account conversion  
- **Conversion Rate**: Personal performance metrics
- **Next Actions**: Tasks and follow-ups

#### **Manager Dashboard**
- **Team Lead Pipeline**: All leads by status
- **Conversion Performance**: Team member comparisons
- **Account Creation Rate**: New vs existing customer ratio
- **Revenue Attribution**: Lead source ROI

---

## üéØ **Best Practices for Sales Reps**

### **Immediate Actions (0-24 hours)**
1. **Review lead details** thoroughly
2. **Research the company** and contact on LinkedIn
3. **Personalize first outreach** with relevant insights
4. **Set follow-up tasks** in the system

### **Qualification Criteria**
- **BANT Framework**: Budget, Authority, Need, Timeline
- **Lead Score Thresholds**: 
  - **High (80-100)**: Immediate follow-up required
  - **Medium (50-79)**: Nurture with content
  - **Low (< 50)**: Add to general marketing campaigns

### **Conversion Guidelines**
- **New Accounts**: Focus on pain points and solution fit
- **Existing Accounts**: Focus on expansion and additional needs
- **Renewals**: Focus on value delivered and future opportunities

---

## üîó **Integration Points**

### **Cross-Module Data Flow**
```
Leads ‚Üí Accounts ‚Üí Opportunities ‚Üí Cases ‚Üí NPS
  ‚Üì        ‚Üì           ‚Üì            ‚Üì        ‚Üì
Marketing ‚Üí CRM ‚Üí Sales ‚Üí Support ‚Üí Customer Success
```

### **Key Integration Benefits**
- **360¬∞ Customer View**: All interactions in one timeline
- **Automated Workflows**: Handoffs between departments  
- **Consistent Data**: Single source of truth across modules
- **Performance Attribution**: Clear ROI from lead to revenue

This comprehensive post-lead-creation workflow ensures that every lead is properly nurtured, qualified, and converted while maintaining data integrity and providing clear next steps for sales representatives.







# üéØ **Lead Status Choices and Lead Scoring Relationship**

The `LEAD_STATUS_CHOICES` and `lead_score` work together as a **dynamic qualification system** that guides sales reps through the lead lifecycle. Here's how they interact:

---

## üìä **Status-to-Score Mapping**

### **1. New (0-39 points)**
- **Score Range**: 0-39
- **Meaning**: Unqualified, needs nurturing
- **Actions**: 
  - Marketing automation campaigns
  - Content delivery (whitepapers, case studies)
  - Email nurturing sequences
- **Next Step**: Score increase through engagement ‚Üí `contacted`

### **2. Contacted (40-69 points)**
- **Score Range**: 40-69  
- **Meaning**: Engaged but not yet qualified
- **Actions**:
  - Sales rep makes initial contact
  - Discovery calls/questions
  - Budget and timeline assessment
- **Next Step**: Qualification criteria met ‚Üí `qualified`

### **3. Qualified (70-100 points)**
- **Score Range**: 70-100
- **Meaning**: Ready for conversion/sale
- **Actions**:
  - Product demos
  - Proposal creation
  - Pricing discussions
  - Account/opportunity creation
- **Next Step**: Deal closed ‚Üí `converted`

### **4. Unqualified (< 40 points after contact)**
- **Score Range**: Any score, but failed qualification criteria
- **Meaning**: Not a good fit despite engagement
- **Actions**:
  - Remove from active sales pipeline
  - Add to long-term nurture campaigns
  - Document disqualification reason
- **Next Step**: Archive or long-term nurturing

### **5. Converted (100 points achieved)**
- **Score Range**: 100 (conversion achieved)
- **Meaning**: Successfully converted to account/opportunity
- **Actions**:
  - Create account and/or opportunity
  - Hand off to account management
  - Begin onboarding process
- **Next Step**: Account lifecycle management

---

## üîß **Technical Implementation**

### **Automatic Status Updates Based on Score**

**File**: `apps/leads/models.py`

```python
class Lead(TenantModel):
    # ... existing fields ...
    lead_score = models.IntegerField(default=0)  # 0‚Äì100
    status = models.CharField(max_length=20, choices=LEAD_STATUS_CHOICES, default='new')
    
    def update_status_from_score(self):
        """Automatically update status based on lead score."""
        old_status = self.status
        
        if self.lead_score >= 70:
            self.status = 'qualified'
        elif self.lead_score >= 40:
            self.status = 'contacted'
        elif self.lead_score >= 0:
            self.status = 'new'
        # Note: 'unqualified' and 'converted' are set manually
        
        # Only save if status actually changed
        if self.status != old_status:
            self.save(update_fields=['status'])
            self.create_timeline_event(f"Status updated from {old_status} to {self.status}")
```

### **Score Calculation Logic**

**File**: `apps/leads/utils.py`

```python
def calculate_lead_score(lead):
    """Calculate lead score based on various engagement factors."""
    score = 0
    
    # Basic contact information (10 points each)
    if lead.email:
        score += 10
    if lead.phone:
        score += 10
    if lead.company:
        score += 10
        
    # Engagement scoring
    score += lead.email_open_score  # Track email opens
    score += lead.website_visit_score  # Track website visits
    score += lead.content_engagement_score  # Track content downloads
    
    # Firmographic scoring
    if lead.industry in ['technology', 'finance']:  # High-value industries
        score += 15
    if lead.company_size in ['enterprise', 'mid_market']:
        score += 10
        
    # Behavioral scoring
    if lead.visited_pricing_page:
        score += 20
    if lead.requested_demo:
        score += 25
        
    # Cap score at 100
    return min(score, 100)
```

### **Manual Status Overrides**

**File**: `apps/leads/views.py`

```python
def update_lead_status(request, lead_id):
    """Allow manual status updates with business logic."""
    lead = get_object_or_404(Lead, id=lead_id)
    
    if request.method == 'POST':
        new_status = request.POST.get('status')
        
        # Business rules for status transitions
        if new_status == 'qualified' and lead.lead_score < 50:
            messages.warning(request, "Lead score is low for qualified status. Consider contacting first.")
            
        elif new_status == 'converted' and lead.status != 'qualified':
            messages.error(request, "Only qualified leads can be converted.")
            return redirect('leads:detail', pk=lead_id)
            
        elif new_status == 'unqualified':
            # Require reason for disqualification
            reason = request.POST.get('disqualification_reason')
            if not reason:
                messages.error(request, "Please provide disqualification reason.")
                return redirect('leads:detail', pk=lead_id)
                
        lead.status = new_status
        lead.save()
        
        # Handle conversion
        if new_status == 'converted':
            return handle_lead_conversion(lead, request.user)
            
    return redirect('leads:detail', pk=lead_id)
```

---

## üéØ **Sales Rep Workflow by Status**

### **Status: New (0-39)**
**Sales Rep Actions:**
- Review lead source and basic info
- Add to marketing nurture campaigns
- Monitor score for automatic status changes
- **Can manually contact** if high-potential despite low score

**System Actions:**
- Email nurturing campaigns
- Content recommendation engine
- Score updates based on engagement

### **Status: Contacted (40-69)**
**Sales Rep Actions:**
- Make phone call or send personalized email
- Conduct discovery call
- Assess BANT criteria (Budget, Authority, Need, Timeline)
- Update lead with additional information

**System Actions:**
- Task creation for follow-up
- Email tracking for engagement scoring
- Calendar integration for meeting scheduling

### **Status: Qualified (70-100)**
**Sales Rep Actions:**
- Schedule product demo
- Create and send proposal
- Negotiate pricing and terms
- **Convert to account/opportunity**

**System Actions:**
- Proposal tracking and ESG engagement
- Competitor analysis alerts
- Deal room creation

### **Status: Unqualified**
**Sales Rep Actions:**
- Document reason for disqualification
- Archive or move to long-term nurture
- Identify potential future opportunities

**System Actions:**
- Remove from active pipeline
- Add to 6-month nurture campaign
- Competitor win/loss tracking

### **Status: Converted**
**Sales Rep Actions:**
- Hand off to account management
- Begin onboarding process
- Celebrate the win!

**System Actions:**
- Account creation
- Opportunity creation
- Customer success workflow initiation
- NPS survey scheduling

---

## üìà **Business Intelligence & Reporting**

### **Key Metrics by Status**

| **Status** | **Key Metrics** | **Target Conversion Rate** |
|------------|----------------|---------------------------|
| New | Lead Score Velocity, Engagement Rate | 60% ‚Üí Contacted |
| Contacted | Response Rate, Discovery Call Completion | 40% ‚Üí Qualified |
| Qualified | Demo Completion, Proposal Acceptance | 25% ‚Üí Converted |
| Unqualified | Disqualification Reasons, Competitor Analysis | Track for pattern recognition |
| Converted | Deal Size, Sales Cycle Length | Revenue Attribution |

### **Automated Alerts**

- **Score Threshold Alerts**: Notify when lead score crosses 40 or 70
- **Stagnation Alerts**: Lead in same status for > 7 days
- **High-Value Alerts**: Lead score > 85 requires immediate attention
- **Conversion Alerts**: Qualified lead not converted within 14 days

---

## üîó **Integration with Other Modules**

### **Marketing Module**
- **New leads** ‚Üí Trigger nurture campaigns
- **Score updates** ‚Üí Adjust email content and frequency
- **Qualified leads** ‚Üí Stop marketing campaigns, start sales campaigns

### **Accounts Module**  
- **Converted leads** ‚Üí Create new accounts automatically
- **Existing account leads** ‚Üí Update account health score
- **Lead history** ‚Üí Visible in account timeline

### **Opportunities Module**
- **Qualified leads** ‚Üí Create opportunities with proper pipeline stages
- **Lead scoring** ‚Üí Influences opportunity weighted value calculation
- **Conversion tracking** ‚Üí Measures lead-to-opportunity success rate

### **Engagement Hub**
- **All lead activities** ‚Üí Tracked in engagement feed
- **Score changes** ‚Üí Generate engagement events
- **Status updates** ‚Üí Create timeline events

This integrated system ensures that **lead scoring drives automation** while **status provides human-readable workflow stages**, giving sales reps both data-driven insights and clear action steps throughout the lead lifecycle.






























# üöÄ **Complete Lead-to-Opportunity Flow**

Here's the complete journey from lead creation to opportunity, covering both new prospects and existing customers:

---

## üìã **Phase 1: Lead Creation**

### **Step 1: Lead Entry**
**Module**: Leads Module
**Templates**: `leads/lead_form.html` or `leads/lead_from_account_form.html`

```python
# Lead creation
lead = Lead.objects.create(
    first_name="John",
    last_name="Doe", 
    company="New Prospect Inc",  # OR existing account name
    email="john@newprospect.com",
    lead_source="web_form",
    status="new",
    lead_score=10,  # Initial score from basic info
    account=None,   # Only for new prospects
    # account=existing_account  # For existing customers
)
```

### **Step 2: Automatic Scoring & Initial Status**
**System Action**: Calculate initial lead score
**Status**: `new` (0-39 points)

---

## üîç **Phase 2: Lead Qualification**

### **Step 3: Lead Scoring Updates**
**Module**: Engagement Hub + Leads Module  
**Triggers**: Email opens, website visits, content downloads

```python
# Example scoring events
def track_email_open(lead_id):
    lead = Lead.objects.get(id=lead_id)
    lead.lead_score += 5
    lead.save()
    lead.update_status_from_score()  # Auto-update status if score crosses threshold
```

### **Step 4: Status Progression**
**Sales Rep Actions**: Manual qualification or automatic based on score

| **Score Range** | **Status** | **Sales Rep Action** |
|----------------|------------|---------------------|
| 0-39 | `new` | Review, nurture, or contact |
| 40-69 | `contacted` | Discovery call, BANT assessment |
| 70-100 | `qualified` | Demo, proposal, conversion prep |

---

## üéØ **Phase 3: Opportunity Creation**

### **Step 5: Choose Conversion Path**

#### **Path A: New Prospect ‚Üí New Account ‚Üí Opportunity**
**When**: `lead.account = None` and `lead.converted_to_account = None`

```python
# Convert lead to account first
account = Account.objects.create(
    name=lead.company,
    industry=lead.industry,
    owner=lead.owner,
    tenant_id=lead.tenant_id
)

# Create primary contact
contact = Contact.objects.create(
    account=account,
    first_name=lead.first_name,
    last_name=lead.last_name,
    email=lead.email,
    is_primary=True,
    tenant_id=lead.tenant_id
)

# Update lead
lead.converted_to_account = account
lead.status = 'converted'
lead.save()

# Create opportunity
opportunity = Opportunity.objects.create(
    account=account,  # New account
    name=f"Initial Opportunity - {account.name}",
    lead_source=lead.lead_source,
    owner=lead.owner,
    tenant_id=lead.tenant_id
)
```

#### **Path B: Existing Customer ‚Üí Direct Opportunity**
**When**: `lead.account = existing_account`

```python
# Direct opportunity creation
opportunity = Opportunity.objects.create(
    account=lead.account,  # Existing account
    name=f"{lead.get_lead_source_display()} - {lead.account.name}",
    lead_source=lead.lead_source,
    owner=lead.owner,
    tenant_id=lead.tenant_id
)

# Update lead
lead.status = 'converted'
lead.save()
```

### **Step 6: Opportunity Details Setup**
**Module**: Opportunities Module
**Template**: `opportunities/opportunity_form.html`

```python
# Opportunity fields populated based on lead
opportunity = Opportunity(
    account=account,
    name="Product Demo Request - Acme Corp",
    amount=50000,  # Estimated from lead scoring or industry data
    stage="prospecting",
    probability=10,  # Initial probability based on lead source
    close_date=timezone.now() + timedelta(days=90),
    description=lead.description,  # From lead form
    owner=lead.owner
)
```

---

## üìä **Phase 4: Pipeline Management**

### **Step 7: Opportunity Status Tracking**
**Module**: Opportunities Module
**Pipeline Stages**:

| **Stage** | **Probability** | **Actions** |
|-----------|----------------|-------------|
| `prospecting` | 10% | Initial contact, needs assessment |
| `qualification` | 25% | Budget confirmed, authority verified |
| `proposal` | 50% | Demo completed, proposal sent |
| `negotiation` | 75% | Pricing discussions, terms negotiation |
| `closed_won` | 100% | Deal closed, account onboarding |
| `closed_lost` | 0% | Deal lost, reason documented |

### **Step 8: Automated Workflow Triggers**
**Module**: Automation + Marketing Modules

```python
# Example automation rules triggered by opportunity creation
{
    "trigger": "opportunity.created",
    "conditions": {"stage": "prospecting"},
    "actions": [
        "send_email_template(proposal_template)",
        "create_task(follow_up_in_3_days)",
        "update_account_health_score(+5)"
    ]
}
```

---

## üîó **Complete Data Flow Diagram**

```
LEAD CREATION
     ‚Üì
Initial Status: new (0-39 score)
     ‚Üì
ENGAGEMENT & SCORING
     ‚Üì
Status: contacted (40-69 score) ‚Üí Manual qualification
     ‚Üì
Status: qualified (70-100 score)
     ‚Üì
CONVERSION DECISION
     ‚îú‚îÄ‚îÄ‚îÄ‚ñ∂ NEW PROSPECT ‚îÄ‚îÄ‚îÄ‚ñ∂ Create Account ‚îÄ‚îÄ‚îÄ‚ñ∂ Create Opportunity
     ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚ñ∂ EXISTING CUSTOMER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ Create Opportunity
                                                   ‚Üì
                                           OPPORTUNITY PIPELINE
                                                   ‚Üì
                                           Closed Won/Lost
```

---

## üéØ **User Interface Flow**

### **Lead Detail Page Actions**
```html
<!-- Lead Status: new or contacted -->
{% if lead.status in:'new,contacted' and lead.lead_score >= 70 %}
    <button class="btn btn-success" onclick="qualifyLead({{ lead.id }})">‚úÖ Mark as Qualified</button>
{% endif %}

<!-- Lead Status: qualified -->
{% if lead.status == 'qualified' %}
    {% if lead.account %}
        <!-- Existing customer -->
        <a href="{% url 'opportunities:create_from_lead' lead.id %}" class="btn btn-primary">
            üíº Create Opportunity
        </a>
    {% else %}
        <!-- New prospect -->
        <a href="{% url 'leads:convert_to_account' lead.id %}" class="btn btn-success">
            üè¢ Convert to Account + Opportunity
        </a>
    {% endif %}
{% endif %}
```

### **Opportunity Creation Templates**

#### **For New Prospects**: `leads/convert_lead_to_account.html`
```html
<form method="post">
    {% csrf_token %}
    <!-- Account fields -->
    {{ account_form.name }}
    {{ account_form.industry }}
    
    <!-- Opportunity fields -->  
    {{ opportunity_form.name }}
    {{ opportunity_form.amount }}
    {{ opportunity_form.close_date }}
    
    <button type="submit">Create Account & Opportunity</button>
</form>
```

#### **For Existing Customers**: `opportunities/opportunity_form.html`
```html
<form method="post">
    {% csrf_token %}
    <!-- Opportunity fields only -->
    {{ form.name }}
    {{ form.amount }}
    {{ form.stage }}
    {{ form.close_date }}
    
    <!-- Hidden account field -->
    <input type="hidden" name="account" value="{{ lead.account.id }}">
    
    <button type="submit">Create Opportunity</button>
</form>
```

---

## üìà **Business Intelligence Tracking**

### **Key Metrics by Conversion Path**

| **Metric** | **New Prospect Path** | **Existing Customer Path** |
|------------|----------------------|---------------------------|
| Avg. Sales Cycle | 60-90 days | 30-45 days |
| Win Rate | 25-35% | 60-75% |
| Deal Size | $25K-$100K | $10K-$50K |
| Lead Score at Conversion | 75-100 | 60-90 |

### **Automated Reporting**
**Module**: Reports Module
**Reports Generated**:
- Lead-to-Opportunity Conversion Rate
- Sales Cycle Length by Lead Source
- Win/Loss Analysis by Account Type
- Revenue Attribution by Lead Origin

---

## ü§ñ **Automation Examples**

### **New Prospect Automation**
```python
# Trigger: lead.status = 'qualified' and lead.account = None
actions = [
    "send_welcome_email(lead)",
    "create_account_from_lead(lead)", 
    "create_opportunity_from_lead(lead)",
    "assign_account_manager(new_account)",
    "start_onboarding_sequence(new_account)"
]
```

### **Existing Customer Automation**
```python
# Trigger: lead.status = 'qualified' and lead.account exists  
actions = [
    "notify_account_manager(lead.account, lead)",
    "create_opportunity_from_lead(lead)",
    "update_account_health_score(+10)",
    "add_esg_engagement_tracking(lead.account)"
]
```

This complete flow ensures that **every lead** is properly qualified, converted, and tracked through the opportunity pipeline, with different paths optimized for **new customer acquisition** vs **existing customer expansion**.