{% extends "inventory/base.html" %}
{% load humanize %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'inventory:dashboard' %}">Inventory</a></li>
            <li class="breadcrumb-item"><a href="{% url 'inventory:warehouse_list' %}">Warehouses</a></li>
            <li class="breadcrumb-item active">{{ object.warehouse_name }}</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Warehouse Info -->
        <div class="col-lg-4 mb-4">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="card-title">{{ object.warehouse_name }}</h5>
                        <a href="{% url 'inventory:warehouse_edit' object.pk %}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-pencil"></i>
                        </a>
                    </div>

                    <div class="mb-3">
                        {% if object.is_default %}
                        <span class="badge bg-primary me-1">Default Warehouse</span>
                        {% endif %}
                        {% if object.is_active %}
                        <span class="badge bg-success-subtle text-success">Active</span>
                        {% else %}
                        <span class="badge bg-secondary-subtle text-secondary">Inactive</span>
                        {% endif %}
                    </div>

                    <div class="text-muted small mb-3">
                        <div class="mb-1"><i class="bi bi-upc-scan me-2"></i>Code: {{ object.warehouse_code }}</div>
                        {% if object.phone %}
                        <div class="mb-1"><i class="bi bi-telephone me-2"></i>{{ object.phone }}</div>
                        {% endif %}
                        {% if object.email %}
                        <div class="mb-1"><i class="bi bi-envelope me-2"></i>{{ object.email }}</div>
                        {% endif %}
                    </div>

                    {% if object.address %}
                    <div class="text-muted small border-top pt-3">
                        <i class="bi bi-geo-alt me-2"></i>
                        {{ object.address }}<br>
                        {% if object.city or object.state %}
                        <span class="ms-4">{{ object.city }} {{ object.state }} {{ object.postal_code }}</span><br>
                        {% endif %}
                        <span class="ms-4">{{ object.country }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Warehouse Actions -->
            <div class="d-grid gap-2">
                <a href="{% url 'inventory:stock_add' %}?warehouse={{ object.id }}" class="btn btn-success">
                    <i class="bi bi-plus-lg me-2"></i>Add Stock Here
                </a>
                <a href="{% url 'inventory:stock_transfer' %}?from={{ object.id }}" class="btn btn-primary">
                    <i class="bi bi-arrow-right me-2"></i>Transfer From Here
                </a>
            </div>
        </div>

        <!-- Stock and Movements -->
        <div class="col-lg-8">
            <!-- Stock Levels -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Current Stock</h5>
                    <a href="{% url 'inventory:stock_list' %}?warehouse={{ object.id }}"
                        class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th>Product</th>
                                <th>Location</th>
                                <th class="text-end">Quantity</th>
                                <th class="text-end">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stock in stock_levels|slice:":5" %}
                            <tr>
                                <td>
                                    <div class="fw-medium">
                                        <a href="{% url 'inventory:stock_detail' stock.pk %}"
                                            class="text-decoration-none text-dark">
                                            {{ stock.product.product_name }}
                                        </a>
                                    </div>
                                    <div class="small text-muted">{{ stock.product.sku }}</div>
                                </td>
                                <td>{{ stock.location.location_code|default:"-" }}</td>
                                <td class="text-end fw-bold">{{ stock.quantity|floatformat:0 }}</td>
                                <td class="text-end">{{ stock.stock_value|floatformat:2|intcomma }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-4 text-muted">No stock in this warehouse</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Movements -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Activity</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Product</th>
                                <th class="text-end">Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for movement in recent_movements %}
                            <tr>
                                <td>{{ movement.created_at|date:"M d, H:i" }}</td>
                                <td>
                                    {% if movement.movement_type == 'in' %}
                                    <span class="badge bg-success-subtle text-success">In</span>
                                    {% elif movement.movement_type == 'out' %}
                                    <span class="badge bg-danger-subtle text-danger">Out</span>
                                    {% elif movement.movement_type == 'transfer' %}
                                    {% if movement.from_warehouse == object %}
                                    <span class="badge bg-warning-subtle text-warning">Transfer Out</span>
                                    {% else %}
                                    <span class="badge bg-info-subtle text-info">Transfer In</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="badge bg-secondary-subtle text-secondary">{{
                                        movement.get_movement_type_display }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ movement.product.product_name }}</td>
                                <td class="text-end">
                                    {% if movement.from_warehouse == object %}-{% else %}+{% endif %}{{
                                    movement.quantity|floatformat:0 }}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-4 text-muted">No recent activity</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}